<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Robbie Gym">
  <link rel="apple-touch-icon" href="assets/icon-192.png">
  <link rel="manifest" href="manifest.json">
  <title>Boxing for Fitness</title>
  <style>
    :root {
      --pad: clamp(10px, 2vmin, 18px);
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --bg: #0b0b0d;
      --card: #121316;
      --text: #f9fafb;
      --muted: #a3a3a3;
      --accent: #ef4444;
      --line: #2a2b31;
    }
    * { box-sizing: border-box; }
    html, body {height:100%; margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;}
    body {background: var(--bg); color: var(--text); -webkit-tap-highlight-color: transparent;}
    .wrap {max-width: 1100px; margin: 0 auto; padding: calc(var(--pad) * 2) var(--pad);}
    header {display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; margin-bottom: calc(var(--pad) * 1.5);}
    h1 {font-size: clamp(22px, 4.2vw, 34px); margin:0;}
    .muted {color: var(--muted); font-size: .95rem;}
    nav {display:flex; gap:8px; flex-wrap: wrap;}
    nav button {border:1px solid var(--line); background: #15161a; color: var(--text); border-radius: 999px; padding: 10px 14px; cursor:pointer;}
    nav button.active {background: var(--accent); border-color: var(--accent); color: white;}
    .card {background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); padding: calc(var(--pad) * 1.2); border: 1px solid var(--line);}
    .grid {display:grid; gap: var(--pad);}
    .cols-2 {grid-template-columns: repeat(2, minmax(0, 1fr));}
    .cols-3 {grid-template-columns: repeat(3, minmax(0, 1fr));}
    .row {display:flex; gap: var(--pad); flex-wrap: wrap; align-items: center;}
    input, select, textarea {width:100%; background:#0e0f12; color: var(--text); border:1px solid var(--line); border-radius:12px; padding:12px 12px; outline:none;}
    input[type="number"] {max-width: 160px;}
    label {font-size:.9rem; color: var(--muted);}
    .btn {border:0; border-radius: 12px; padding: 12px 16px; font-size: 1rem; cursor:pointer; background: var(--accent); color:white; box-shadow: var(--shadow);}
    .btn.secondary {background:#23252b; color: var(--text);}
    .btn.ghost {background:transparent; border:1px solid var(--line);}
    .btn.sm {padding:8px 12px; font-size:.95rem;}
    table {width:100%; border-collapse: collapse; font-size:.98rem;}
    th, td {padding: 10px 8px; border-bottom:1px solid var(--line); text-align:left;}
    th {color: var(--muted); font-weight: 600;}
    .chip {display:inline-block; padding: 6px 10px; border-radius:999px; border:1px solid var(--line); background:#14151a;}
    .tag {font-size:.85rem; color: var(--muted);}
    .section-title {margin: 8px 0 14px 0;}
    .session-grid {display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));}
    .session {border:1px solid var(--line); border-radius:12px; padding:14px; background:#111217; cursor:pointer; transition: background 0.2s, transform 0.2s;}
    .session:hover {background:#181920; transform:scale(1.02);}
    .session.active {outline: 2px solid var(--accent);}
    .session .time {font-weight:700;}
    .toast {position: fixed; left: 50%; transform: translateX(-50%); bottom: 18px; background: #111827; color: white; padding: 10px 14px; border-radius: 999px; display:none;}
    .hint {font-size:.9rem; color: var(--muted);}
    @media (max-width: 900px) { .cols-3 {grid-template-columns: 1fr;} .cols-2{grid-template-columns: 1fr;} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="row" style="align-items:center; gap:12px;">
          <img src="assets/bff-logo.png" alt="Boxing for Fitness" style="height:48px; width:auto;"/>
          <h1>Boxing for Fitness</h1>
        </div>
        <div class="muted">Check-ins, credits, and sessions — works offline. First class is free.</div>
      </div>
      <nav>
        <button class="active" data-tab="checkin">Check-in</button>
        <button data-tab="members">Members</button>
        <button data-tab="payments">Payments</button>
        <button data-tab="reports">Reports</button>
        <button id="installBtn" class="ghost">Install</button>
      </nav>
    </header>

    <section id="tab-checkin" class="card">
      <h3 class="section-title">Sessions</h3>
      <div class="session-grid" id="sessionGrid"></div>
      <div class="row" style="margin-top:14px;">
        <div style="flex:2;">
          <label>Member</label>
          <input list="memberList" id="checkinMember" placeholder="Search name or phone">
          <datalist id="memberList"></datalist>
        </div>
        <div style="flex:1;">
          <label>Selected Session</label>
          <input id="selectedSession" readonly>
        </div>
        <div style="align-self:end;">
          <button id="confirmCheckin" class="btn">Confirm Check-in</button>
        </div>
      </div>
      <div class="hint">Credit automatically deducted (1 per class). If balance is 0, you’ll be prompted to add a pack or single.</div>
    </section>

    <section id="tab-members" class="card" style="display:none;">
      <div class="grid cols-3">
        <div>
          <h3 class="section-title">Add Member</h3>
          <div class="grid">
            <div>
              <label>Full name</label>
              <input id="mName" placeholder="e.g., Alex Smith">
            </div>
            <div>
              <label>Phone</label>
              <input id="mPhone" placeholder="e.g., 0400 000 000">
            </div>
            <div>
              <label>Email</label>
              <input id="mEmail" placeholder="e.g., alex@email.com">
            </div>
            <div>
              <label>Notes</label>
              <textarea id="mNotes" placeholder="Injuries, level, etc."></textarea>
            </div>
            <button id="addMember" class="btn">Add (+1 free credit)</button>
            <div class="hint">New members start with 1 free credit.</div>
          </div>
        </div>

        <div class="cols-span-2" style="grid-column: span 2;">
          <h3 class="section-title">Member List</h3>
          <table id="memberTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Credits</th>
                <th></th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="tab-payments" class="card" style="display:none;">
      <div class="row">
        <div style="flex:2;">
          <label>Member</label>
          <input list="memberList" id="payMember" placeholder="Search name or phone">
        </div>
        <div style="flex:1;">
          <label>Pack</label>
          <select id="payPack">
            <option value="single">Single $20 (1 credit)</option>
            <option value="10">10-Pack $180</option>
            <option value="20">20-Pack $360</option>
          </select>
        </div>
        <div style="align-self:end;">
          <button id="addCredit" class="btn">Apply Payment</button>
        </div>
      </div>
      <h3 class="section-title">Recent Transactions</h3>
      <table id="txTable">
        <thead><tr><th>Date</th><th>Type</th><th>Member</th><th>Amount</th><th>Credits</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="tab-reports" class="card" style="display:none;">
      <div class="row">
        <button id="exportAttendance" class="btn secondary">Export Attendance CSV</button>
        <button id="exportPayments" class="btn secondary">Export Payments CSV</button>
      </div>
      <div style="margin-top:16px;">
        <h3 class="section-title">Today at a glance</h3>
        <div id="todaySummary" class="muted">No data yet.</div>
      </div>
      <div style="margin-top:16px;">
        <h3 class="section-title">Latest Check-ins</h3>
        <table id="attTable">
          <thead><tr><th>Date</th><th>Session</th><th>Member</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </div>

  <div id="toast" class="toast">Saved</div>
  <div id="updateToast" class="toast" style="display:none;">⚡ App updated — tap to refresh</div>

  <script src="app.js"></script>
  <script>
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    const isIOS = /iphone|ipad|ipod/i.test(window.navigator.userAgent);
    const installBtn = document.getElementById('installBtn');
    if (!isStandalone && isIOS) installBtn.textContent = 'Add to Home Screen (Share → Add)';

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('./service-worker.js');
          reg.addEventListener('updatefound', () => {
            const newWorker = reg.installing;
            if (!newWorker) return;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                const toast = document.getElementById('updateToast');
                toast.style.display = 'block';
                toast.onclick = () => {
                  (reg.waiting || newWorker).postMessage({ type: 'SKIP_WAITING' });
                };
              }
            });
          });
          navigator.serviceWorker.addEventListener('controllerchange', () => window.location.reload());
        } catch (err) { console.error('Service Worker registration failed:', err); }
      });
    }
  </script>
</body>
</html>
